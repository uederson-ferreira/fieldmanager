# EcoField Offline System - Architecture Diagrams & Data Flow

## 1. SYSTEM ARCHITECTURE OVERVIEW

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EcoField PWA Application                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    React Components Layer                         â”‚   â”‚
â”‚  â”‚  (LVForm, TermoForm, RotinaForm, Dashboard, etc.)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    API Client Layer                               â”‚   â”‚
â”‚  â”‚  (lvAPI.ts, termosAPI.ts, rotinasAPI.ts, metasAPI.ts, etc.)     â”‚   â”‚
â”‚  â”‚                         â”‚                                         â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚  â”‚                    â”‚ Network   â”‚                                  â”‚   â”‚
â”‚  â”‚                    â”‚ Detection â”‚ (useOnlineStatus)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Offline System Layer                             â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚   Managers       â”‚  â”‚   Syncers        â”‚  â”‚   Hooks         â”‚â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LVManager      â”‚  â”‚ â€¢ LVSync         â”‚  â”‚â€¢ useOnlineStatusâ”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ TermoManager   â”‚  â”‚ â€¢ TermoSync      â”‚  â”‚â€¢ useLVSyncStatusâ”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ RotinaManager  â”‚  â”‚ â€¢ RotinaSync     â”‚  â”‚                 â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ FotoManager    â”‚  â”‚ â€¢ InspecaoSync   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ etc.           â”‚  â”‚ â€¢ EncarregadoSyncâ”‚  â”‚  â”‚ Sync Queue â”‚ â”‚â”‚   â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚  â”‚ (Manual UI)â”‚ â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚   â”‚
â”‚  â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚         IndexedDB via Dexie (EcoFieldDB)                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Tables:                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ lvs, lv_avaliacoes, lv_fotos                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ termos_ambientais, termos_fotos                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ atividades_rotina, fotos_rotina                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ inspecoes, respostas_inspecao, fotos_inspecao          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ usuarios, perfis, areas, categorias_lv                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ empresas_contratadas, encarregados                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ lv_residuos, lv_residuos_avaliacoes, lv_residuos_fotosâ”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            Service Worker (public/sw.js)                           â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  â€¢ Asset caching (static files, CSS, JS)                         â”‚ â”‚
â”‚  â”‚  â€¢ Network-first for API calls                                   â”‚ â”‚
â”‚  â”‚  â€¢ Cache-first for images (30-day expiry)                        â”‚ â”‚
â”‚  â”‚  â€¢ Smart expiration & cleanup                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Backend API        â”‚      â”‚  Supabase Database    â”‚
         â”‚  (Node.js/Express)  â”‚      â”‚  (PostgreSQL)         â”‚
         â”‚                     â”‚      â”‚                       â”‚
         â”‚ â€¢ /api/lvs          â”‚      â”‚ â€¢ lvs                 â”‚
         â”‚ â€¢ /api/termos       â”‚      â”‚ â€¢ termos_ambientais   â”‚
         â”‚ â€¢ /api/atividades   â”‚      â”‚ â€¢ atividades_rotina   â”‚
         â”‚ â€¢ /api/sync/*       â”‚      â”‚ â€¢ usuarios            â”‚
         â”‚ â€¢ /api/upload       â”‚      â”‚ â€¢ areas               â”‚
         â”‚ â€¢ /api/fotos        â”‚      â”‚ â€¢ and more...         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. DATA FLOW DIAGRAM: Offline to Online Synchronization

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     OFFLINE SCENARIO                                 â”‚
â”‚                                                                      â”‚
â”‚  User Creates LV Offline (Lost Network)                            â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ React Component calls lvAPI.criarLV(dados)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Network Request Fails (network error)        â”‚                  â”‚
â”‚  â”‚ API returns error                            â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Component catches error, saves to IndexedDB: â”‚                  â”‚
â”‚  â”‚ await LVManager.save({                       â”‚                  â”‚
â”‚  â”‚   ...lv,                                     â”‚                  â”‚
â”‚  â”‚   sincronizado: false,                       â”‚                  â”‚
â”‚  â”‚   offline: true                              â”‚                  â”‚
â”‚  â”‚ })                                           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Data persisted to IndexedDB (local storage) â”‚                  â”‚
â”‚  â”‚ â€¢ LV record: { id, tipo_lv, ..., sync: false} â”‚                  â”‚
â”‚  â”‚ â€¢ User notified: "Saved offline"            â”‚                  â”‚
â”‚  â”‚ â€¢ UI shows pending count badge              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚
â”‚           NETWORK RESTORED - USER COMES ONLINE                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚
â”‚                                                                     â”‚
â”‚  useOnlineStatus Hook detects: isOnline = true                    â”‚
â”‚           â”‚                                                        â”‚
â”‚           â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ User clicks "Sincronizar" button (manual)    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SYNC PHASE (Online)                              â”‚
â”‚                                                                      â”‚
â”‚  useLVSyncStatus Hook: syncNow()                                    â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Retrieve pending records from IndexedDB:     â”‚                  â”‚
â”‚  â”‚ getPendentes() â†’ Find all sync: false recordsâ”‚                  â”‚
â”‚  â”‚ Returns: [LV1(sync:false), LV2(sync:false)]  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ For each LV: LVSync.syncOne(lv)              â”‚                  â”‚
â”‚  â”‚    1. prepararDadosParaBackend()             â”‚                  â”‚
â”‚  â”‚       Map offline fields â†’ backend format    â”‚                  â”‚
â”‚  â”‚                                              â”‚                  â”‚
â”‚  â”‚    2. enviarParaBackend()                    â”‚                  â”‚
â”‚  â”‚       POST /api/lvs with JSON data           â”‚                  â”‚
â”‚  â”‚       Include auth token in headers          â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Backend Response Handling:                   â”‚                  â”‚
â”‚  â”‚                                              â”‚                  â”‚
â”‚  â”‚ SUCCESS (200 + data with new ID):           â”‚                  â”‚
â”‚  â”‚   â”œâ”€ Store new ID from backend               â”‚                  â”‚
â”‚  â”‚   â”œâ”€ Sync avaliacoes (POST /lvs/{id}/aval.) â”‚                  â”‚
â”‚  â”‚   â”œâ”€ Sync fotos (POST /lvs/{id}/fotos)      â”‚                  â”‚
â”‚  â”‚   â””â”€ Delete from IndexedDB                   â”‚                  â”‚
â”‚  â”‚                                              â”‚                  â”‚
â”‚  â”‚ FAILURE (4xx/5xx error):                    â”‚                  â”‚
â”‚  â”‚   â”œâ”€ Log error details                       â”‚                  â”‚
â”‚  â”‚   â”œâ”€ Implement fallback (change to SINC-)   â”‚                  â”‚
â”‚  â”‚   â””â”€ Keep in IndexedDB for retry             â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Photo Sync (if LV has photos):               â”‚                  â”‚
â”‚  â”‚   1. Convert base64 â†’ Blob                   â”‚                  â”‚
â”‚  â”‚   2. Create FormData with file               â”‚                  â”‚
â”‚  â”‚   3. POST /api/lvs/{id}/fotos                â”‚                  â”‚
â”‚  â”‚   4. Receive URL from backend                â”‚                  â”‚
â”‚  â”‚   5. Delete photo record from IndexedDB      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                      â”‚
â”‚              â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Sync Complete:                               â”‚                  â”‚
â”‚  â”‚ â€¢ Update UI (remove badge, show success)     â”‚                  â”‚
â”‚  â”‚ â€¢ Fire events (meta:atualizar, etc.)         â”‚                  â”‚
â”‚  â”‚ â€¢ Reset pending count                        â”‚                  â”‚
â”‚  â”‚ â€¢ User can logout safely                     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ENTITY RELATIONSHIP DIAGRAM (IndexedDB Schema)

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LV (Listas de VerificaÃ§Ã£o)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id                    â”‚ tipo_lv                                â”‚
â”‚    numero_lv              â”‚ nome_lv                                â”‚
â”‚    usuario_id             â”‚ usuario_nome                           â”‚
â”‚    data_inspecao          â”‚ area                                   â”‚
â”‚    status                 â”‚ sincronizado [INDEX]                   â”‚
â”‚    offline                â”‚ created_at, updated_at                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                   â”‚
             â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                    â”‚  LVAvaliacao                â”‚
             â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚                    â”‚ PK: id                      â”‚
             â”‚                    â”‚ FK: lv_id [INDEX]           â”‚
             â”‚                    â”‚    item_id, avaliacao       â”‚
             â”‚                    â”‚    sincronizado [INDEX]     â”‚
             â”‚                    â”‚    offline                  â”‚
             â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚   LVFoto             â”‚   â”‚
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
                â”‚ PK: id               â”‚   â”‚
                â”‚ FK: lv_id [INDEX]    â”‚   â”‚
                â”‚    nome_arquivo      â”‚   â”‚
                â”‚    url_foto (base64) â”‚   â”‚
                â”‚    sincronizado      â”‚   â”‚
                â”‚    offline           â”‚   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ TermoAmbiental         â”‚
                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                   â”‚ PK: id                 â”‚
                                   â”‚    numero_termo        â”‚
                                   â”‚    numero_sequencial   â”‚
                                   â”‚    tipo_termo          â”‚
                                   â”‚    emitido_por_usuario â”‚
                                   â”‚    data_termo          â”‚
                                   â”‚    sincronizado[INDEX] â”‚
                                   â”‚    offline             â”‚
                                   â”‚    + 60 more fields    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                                   â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TermoFoto        â”‚           â”‚ AtividadeRotina   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ PK: id           â”‚           â”‚ PK: id            â”‚
                    â”‚ FK: termo_id     â”‚           â”‚    data_atividade â”‚
                    â”‚    categoria     â”‚           â”‚    area_id[INDEX] â”‚
                    â”‚    arquivo_base64â”‚           â”‚    sincronizado   â”‚
                    â”‚    sincronizado  â”‚           â”‚    offline        â”‚
                    â”‚    offline       â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                                            â”‚
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                         â”‚ FotoRotina               â”‚
                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â”‚ PK: id                   â”‚
                                         â”‚ FK: atividade_id[INDEX]  â”‚
                                         â”‚    arquivo (base64)      â”‚
                                         â”‚    sincronizado          â”‚
                                         â”‚    offline               â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Inspecao         â”‚         â”‚ LVResiduos       â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ PK: id           â”‚         â”‚ PK: id           â”‚
   â”‚    data_inspecao â”‚         â”‚    usuario_id    â”‚
   â”‚    area_id       â”‚         â”‚    area          â”‚
   â”‚    responsavel   â”‚         â”‚    sincronizado  â”‚
   â”‚    sincronizado  â”‚         â”‚    offline       â”‚
   â”‚    offline       â”‚         â”‚    statusSync    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚              â”‚              â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚ RespostaInsp.â”‚  â”‚ LVResiduosAvâ”‚  â”‚
                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Å£â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚ FK: inspecao â”‚  â”‚ FK: lv_id    â”‚  â”‚
                    â”‚    pergunta  â”‚  â”‚    sincroniz â”‚  â”‚
                    â”‚    sincroniz â”‚  â”‚    offline   â”‚  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                        â”‚
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                       â”‚ LVResiduosFoto        â”‚
                                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                       â”‚ FK: lv_id             â”‚
                                       â”‚    nome_arquivo       â”‚
                                       â”‚    sincronizado       â”‚
                                       â”‚    offline            â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Usuario      â”‚  â”‚ Perfil       â”‚  â”‚ Area        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ id           â”‚  â”‚ id, nome     â”‚  â”‚ id, nome    â”‚
   â”‚ nome, email  â”‚  â”‚ ativo, perms â”‚  â”‚ ativa       â”‚
   â”‚ perfil       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ ativo        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
  PK: Primary Key    FK: Foreign Key    [INDEX]: Indexed Field
```

---

## 4. SYNC PROCESS SEQUENCE DIAGRAM

```bash
User              Frontend         IndexedDB        Backend API      Supabase
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚ 1. Create LV   â”‚                 â”‚                 â”‚                â”‚
  â”‚â”€offlineâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 2. Network Fail â”‚                 â”‚                â”‚
  â”‚                 â”‚â”€â”€â”€â”€save errorâ”€â”€â”€>â”‚ 3. PUT LV      â”‚                â”‚
  â”‚                 â”‚                 â”‚ (sync:false)    â”‚                â”‚
  â”‚                 â”‚<â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚
  â”‚<â”€â”€â”€â”€"Offline"â”€â”€â”€â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â”‚
  â”‚           Network Restored - User Clicks Sync                       â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚ 4. Sync         â”‚                 â”‚                 â”‚                â”‚
  â”‚â”€clickâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 5. getPendentesâ”‚                 â”‚                â”‚
  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 6. Query       â”‚                â”‚
  â”‚                 â”‚                 â”‚ (sync:false)   â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚<â”€LV listâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 7. prepareData  â”‚                 â”‚                â”‚
  â”‚                 â”‚  (field mapping)â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 8. POST /api/lvsâ”‚                 â”‚                â”‚
  â”‚                 â”‚â”€â”€â”€â”€â”€LV dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚ 9. Validate   â”‚
  â”‚                 â”‚                 â”‚                 â”‚ & Save        â”‚
  â”‚                 â”‚                 â”‚                 â”‚â”€â”€â”€â”€â”€â”€INSERTâ”€â”€â”€â”€â”€â”€>
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚<â”€â”€â”€â”€IDâ”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€200 + IDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 10. syncAvaliacoes                â”‚                â”‚
  â”‚                 â”‚â”€â”€â”€â”€POST /lvs/{id}/avalâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚ 11. Insert    â”‚
  â”‚                 â”‚                 â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€200â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 12. syncFotos (FormData)          â”‚                â”‚
  â”‚                 â”‚â”€â”€POST /lvs/{id}/fotosâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚ 13. Upload    â”‚
  â”‚                 â”‚                 â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€200â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚ 14. DELETE LV   â”‚                 â”‚                â”‚
  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚ 15. DELETE OK   â”‚                â”‚
  â”‚                 â”‚                 â”‚ (remove sync:F) â”‚                â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  â”‚<â”€â”€"Sync OK"â”€â”€â”€â”€â”€â”‚                 â”‚                 â”‚                â”‚
  â”‚                 â”‚                 â”‚                 â”‚                â”‚
  
  
FAILURE PATH:
User              Frontend         IndexedDB        Backend API
  â”‚                 â”‚                 â”‚                 â”‚
  â”‚ 8. POST /api/lvsâ”‚                 â”‚                 â”‚
  â”‚â”€â”€â”€â”€â”€LV dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
  â”‚                 â”‚                 â”‚                 â”‚
  â”‚                 â”‚               [NETWORK ERROR]    â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€FAILâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                 â”‚                 â”‚
  â”‚                 â”‚ 9. implementarFallback()         â”‚
  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
  â”‚                 â”‚  â€¢ Change numero_termo: OFFâ†’SINC â”‚
  â”‚                 â”‚  â€¢ Set sincronizado: true         â”‚
  â”‚                 â”‚  â€¢ Keep in DB (for retry)         â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
  â”‚<â”€â”€"Error!"â”€â”€â”€â”€â”€â”€â”‚                 â”‚                 â”‚
  â”‚ (SINC- visible) â”‚                 â”‚                 â”‚
```

---

## 5. SYNC QUEUE LOGIC (Current vs. Recommended)

```bash
CURRENT IMPLEMENTATION (Manual Queue):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ User Action (Create LV)
â”‚   â”‚
â”‚   â”œâ”€> LVManager.save(lv, sync: false)
â”‚   â”‚
â”‚   â””â”€> [In IndexedDB]
â”‚       LV { id, ..., sincronizado: false }
â”‚
â”‚
â”œâ”€ User Goes Online
â”‚
â”œâ”€ User Clicks "Sincronizar"
â”‚   â”‚
â”‚   â”œâ”€> useLVSyncStatus.syncNow()
â”‚   â”‚
â”‚   â”œâ”€> LVSync.syncAll()
â”‚   â”‚
â”‚   â”œâ”€> LVManager.getPendentes() â†’ Find all (sync:false)
â”‚   â”‚
â”‚   â”œâ”€> For each:
â”‚   â”‚   â”œâ”€> POST to backend
â”‚   â”‚   â”œâ”€> If Success: DELETE from IndexedDB
â”‚   â”‚   â””â”€> If Fail: implementarFallback()
â”‚   â”‚       â”œâ”€ Change numero: OFF â†’ SINC
â”‚   â”‚       â”œâ”€ Set sync: true (misleading!)
â”‚   â”‚       â””â”€ Keep in DB (manual retry)
â”‚   â”‚
â”‚   â””â”€> Return SyncResult


RECOMMENDED IMPLEMENTATION (Persistent Queue):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ User Action (Create LV)
â”‚   â”‚
â”‚   â”œâ”€> LVManager.save(lv, sync: false)
â”‚   â”‚
â”‚   â”œâ”€> SyncQueue.add({
â”‚   â”‚    entity: 'LV',
â”‚   â”‚    operation: 'create',
â”‚   â”‚    recordId: lv.id,
â”‚   â”‚    priority: 5,
â”‚   â”‚    retries: 0,
â”‚   â”‚    status: 'pending'
â”‚   â”‚   })
â”‚   â”‚
â”‚   â””â”€> [In IndexedDB]
â”‚       SyncQueueItem { id, entity, op, status, retries }
â”‚       LV { id, ..., syncronizado: false }
â”‚
â”‚
â”œâ”€ User Goes Online
â”‚   â”‚
â”‚   â””â”€> ServiceWorker.addEventListener('sync', ...)
â”‚       Automatically trigger background sync
â”‚
â”‚
â”œâ”€ Sync Processing (Automatic or Manual)
â”‚   â”‚
â”‚   â”œâ”€> SyncQueue.processPending()
â”‚   â”‚
â”‚   â”œâ”€> ORDER BY priority, retries
â”‚   â”‚
â”‚   â”œâ”€> TAKE(10) items (batch)
â”‚   â”‚
â”‚   â”œâ”€> For each queue item:
â”‚   â”‚   â”œâ”€> GET record from appropriate table
â”‚   â”‚   â”œâ”€> POST to backend
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€> If Success:
â”‚   â”‚   â”‚   â”œâ”€ DELETE queue item
â”‚   â”‚   â”‚   â”œâ”€ DELETE record (or soft-delete)
â”‚   â”‚   â”‚   â””â”€ Update pending count
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€> If Fail:
â”‚   â”‚       â”œâ”€ Increment retries
â”‚   â”‚       â”œâ”€ Set lastError message
â”‚   â”‚       â”œâ”€ Keep in queue (automatic retry)
â”‚   â”‚       â””â”€ If retries > 5:
â”‚   â”‚           â”œâ”€ Alert user
â”‚   â”‚           â””â”€ Ask for manual intervention
â”‚   â”‚
â”‚   â””â”€> Return batch result
â”‚
â”‚
â””â”€> Automatic retry on next sync trigger
    (No manual user action required!)
```

---

## 6. CONFLICT RESOLUTION SCENARIOS

```bash
Current Implementation: Last-Write-Wins (Silent)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€

T=0: User creates Term "OFF-001" offline
     â””â”€ Offline version: { id, numero: 'OFF-001', descricao: 'Initial' }

T=5: Admin modifies same Term online
     â””â”€ Online version: { id, numero: 'OFF-001', descricao: 'Updated by admin' }

T=10: User syncs
      â”œâ”€ Offline version OVERWRITES online version
      â”œâ”€ Result: { id, numero: 'OFF-001', descricao: 'Initial' }
      â””â”€ USER UNAWARE: Admin's changes lost silently! âŒ


Recommended Implementation: Version-Based Detection
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Schema Addition:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
interface OfflineEntity {
  id: string;
  updated_at: string;           // Local modification time
  last_sync_at: string;          // When last synced from server
  server_version: number;        // Version from server
  local_version: number;         // Local modification count
}

Conflict Detection:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

During sync, check:

1. Query backend for latest version:
   GET /api/lvs/{id} â†’ { server_version: 5, ... }

2. Compare versions:
   â”œâ”€ local_version (1) < server_version (5)
   â”‚  â””â”€ SERVER MODIFIED â†’ CONFLICT!
   â”‚
   â”œâ”€ local_version (1) == server_version (1)
   â”‚  â””â”€ No conflict, safe to sync
   â”‚
   â””â”€ local_version (5) > server_version (1)
      â””â”€ Local modified after server, OK to overwrite

3. On conflict, prompt user:
   
   â”Œâ”€ "Conflito Detectado"
   â”‚  "TÃ©rmino foi modificado tanto offline como online"
   â”‚
   â”œâ”€ OpÃ§Ã£o 1: Manter versÃ£o offline
   â”‚  â””â”€ Overwrite (current behavior, but informed)
   â”‚
   â”œâ”€ OpÃ§Ã£o 2: Manter versÃ£o online
   â”‚  â””â”€ Discard local changes, reload from server
   â”‚
   â”œâ”€ OpÃ§Ã£o 3: Revisar diferenÃ§as
   â”‚  â””â”€ Side-by-side comparison (advanced)
   â”‚
   â””â”€ [Cancelar] [Continuar]


Audit Trail:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Log every sync outcome:
  {
    entity_id: 'xyz-123',
    entity_type: 'termo',
    sync_timestamp: 'ISO-8601',
    local_version: 2,
    server_version: 5,
    conflict_detected: true,
    resolution: 'keep_offline',  // User choice
    local_data: {...},           // What was sent
    server_data: {...}           // What existed on server
  }

Benefits:
  âœ“ User aware of overwrite
  âœ“ Recoverable if user realizes mistake
  âœ“ Admin can audit changes
```

---

## 7. STORAGE MANAGEMENT LIFECYCLE

```bash
Storage Quota Management
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Device Quota:
  Mobile:   50-100MB typical
  Desktop:  1-10GB typical

EcoField Typical Usage:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  10 LVs              â‰ˆ 20MB
  50 Termos           â‰ˆ 25MB
  200 Atividades      â‰ˆ 20MB
  500 Photos (base64) â‰ˆ 250MB  â† Main concern!
                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL              â‰ˆ 315MB   (Exceeds quota!)


Current Problem:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€ No quota monitoring
â”‚  â””â”€ App crashes when IndexedDB full
â”‚
â”œâ”€ No compression
â”‚  â””â”€ base64 photos 33% larger than original
â”‚
â”œâ”€ No cleanup
â”‚  â””â”€ Old data never deleted automatically
â”‚
â””â”€ No warnings
   â””â”€ User unaware of risk until it's too late


Recommended Solution:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Monitor Quota:
   
   const quota = await navigator.storage.estimate();
   const usage = quota.usage;
   const quota_limit = quota.quota;
   const percent = (usage / quota_limit) * 100;
   
   â”œâ”€ < 50%: Green (OK)
   â”œâ”€ 50-80%: Yellow (Warning)
   â””â”€ > 80%: Red (Critical)

2. Warn User:
   
   â”œâ”€ At 70%: "EspaÃ§o offline quase cheio. Recomendamos sincronizar."
   â””â”€ At 90%: "EspaÃ§o crÃ­tico! Sincronizone agora ou delete registros antigos."

3. Auto-Cleanup Strategy:
   
   When usage > 85%:
   â”œâ”€ Delete photos older than 30 days
   â”œâ”€ Archive completed inspections
   â””â”€ Offer manual cleanup UI

4. Photo Compression:
   
   Instead of:
   â”Œâ”€ base64 string (33% overhead)
   â””â”€ Total: 1.33MB per 1MB photo
   
   Use:
   â”Œâ”€ Blob (native IndexedDB type)
   â”œâ”€ Compress before storage (WebP format)
   â””â”€ Total: 0.5MB per 1MB photo (62% savings!)


Lifecycle Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Photo Capture:
  â”‚ (1MB JPEG)
  â”‚
  â”œâ”€> Compress to WebP (0.5MB)
  â”‚
  â”œâ”€> Store Blob in IndexedDB
  â”‚
  â”œâ”€> Show in UI (via Blob URL)
  â”‚
  â”œâ”€> Sync when online:
  â”‚   â”œâ”€ Convert Blob to File
  â”‚   â”œâ”€ POST to API
  â”‚   â””â”€ Delete from IndexedDB
  â”‚
  â””â”€> Or Delete if user cancels

Auto-Cleanup after 30 days:
  â””â”€> If still in IndexedDB
      â””â”€> DELETE to free space
```

---

## 8. ERROR HANDLING & RECOVERY FLOW

```bash
CURRENT ERROR HANDLING (Partial)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Network Error During Sync:
â”œâ”€ Catch error
â”œâ”€ Log to console
â”œâ”€ implementarFallback() for Termos only:
â”‚  â”œâ”€ Change numero: OFF-001 â†’ SINC-001
â”‚  â”œâ”€ Set sincronizado = true (misleading!)
â”‚  â””â”€ Keep in IndexedDB
â””â”€ No user notification âŒ

Photo Upload Error:
â”œâ”€ Log error
â”œâ”€ Continue with next photo
â””â”€ Parent record might be partially synced âŒ

Missing Required Field:
â”œâ”€ No validation before save
â”œâ”€ Sync fails with cryptic error
â””â”€ User confused âŒ


RECOMMENDED ERROR HANDLING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Input Validation:
   
   class LVValidator {
     validate(lv: LV): ValidationResult {
       const errors = [];
       
       if (!lv.tipo_lv) errors.push('Tipo LV obrigatÃ³rio');
       if (!lv.usuario_id) errors.push('UsuÃ¡rio obrigatÃ³rio');
       if (!lv.data_inspecao) errors.push('Data obrigatÃ³ria');
       if (!lv.area) errors.push('Ãrea obrigatÃ³ria');
       
       return {
         valid: errors.length === 0,
         errors
       };
     }
   }
   
   // Use BEFORE saving:
   const validation = LVValidator.validate(lv);
   if (!validation.valid) {
     showError('ValidaÃ§Ã£o:', validation.errors.join(', '));
     return;
   }
   await LVManager.save(lv);

2. Sync Error Classification:
   
   enum SyncErrorType {
     NetworkError = 'network',      // No internet
     TimeoutError = 'timeout',      // Request hung
     ServerError = 'server',        // 5xx errors
     ValidationError = 'validation', // 4xx errors
     ConflictError = 'conflict',    // Data mismatch
     UnauthorizedError = 'auth'     // Token expired
   }
   
   // Categorize and handle:
   if (error.type === SyncErrorType.NetworkError) {
     showMessage('Sem conexÃ£o. Tentaremos novamente quando voltar online.');
     queue.add(item);  // Retry later
   } else if (error.type === SyncErrorType.ValidationError) {
     showError('Dados invÃ¡lidos:', error.details);
     queue.delete(item); // Don't retry
   } else if (error.type === SyncErrorType.UnauthorizedError) {
     showError('SessÃ£o expirada. FaÃ§a login novamente.');
     redirectToLogin();
   }

3. Retry Strategy:
   
   const MAX_RETRIES = 5;
   const RETRY_DELAYS = [1, 5, 15, 60, 300]; // seconds
   
   for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
     try {
       return await syncRecord(record);
     } catch (error) {
       if (attempt < MAX_RETRIES - 1) {
         const delay = RETRY_DELAYS[attempt] * 1000;
         await sleep(delay);  // Exponential backoff
       } else {
         // All retries failed
         queue.item.status = 'failed_manual_review';
         alertUser(`SincronizaÃ§Ã£o falhou apÃ³s ${MAX_RETRIES} tentativas`);
       }
     }
   }

4. User Notifications:
   
   â”œâ”€ Success Toast: "âœ“ 3 LVs sincronizadas com sucesso"
   â”œâ”€ Error Alert: "âŒ Falha ao sincronizar. Tente novamente."
   â”œâ”€ Warning Banner: "âš ï¸ 5 itens aguardando sincronizaÃ§Ã£o"
   â””â”€ Critical Alert: "ğŸ”´ EspaÃ§o de armazenamento cheio!"
```

---

## 9. Mobile-Specific Considerations

```bash
Mobile Device Constraints:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RAM:        2-4GB (limited for large datasets)
Storage:    50-100MB IndexedDB quota
Network:    2G/3G/4G, unstable, metered data
CPU:        Mobile processors, battery drain
Camera:     High-res photos (3-5MB each)


Optimization Strategies:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Photo Handling:
   â”œâ”€ Reduce resolution on capture (2MP target)
   â”œâ”€ Compress immediately (WebP format)
   â”œâ”€ Store as Blob (not base64)
   â””â”€ Result: 500KB per photo instead of 3MB

2. Memory Management:
   â”œâ”€ Don't load all records at once
   â”œâ”€ Implement pagination (50 items at a time)
   â”œâ”€ Clean up event listeners (useEffect cleanup)
   â””â”€ Avoid circular refs (Managers â†’ API â†’ DB)

3. Network Optimization:
   â”œâ”€ Batch operations (POST multiple records)
   â”œâ”€ Compress JSON payloads (gzip)
   â”œâ”€ Use delta sync (only changed fields)
   â””â”€ Implement request cancellation (on navigation)

4. Battery & Data Usage:
   â”œâ”€ Defer sync until WiFi available
   â”œâ”€ Disable sync during low-battery mode
   â”œâ”€ Warn users about data usage for photos
   â””â”€ Implement offline-mode (no API calls)

5. UI Responsiveness:
   â”œâ”€ Show progress during long operations
   â”œâ”€ Don't block main thread during sync
   â”œâ”€ Use Web Workers for heavy processing
   â””â”€ Implement skeleton loaders
```

---

## 10. Summary: System Health Dashboard

```bash
OFFLINE SYSTEM STATUS REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ARCHITECTURE HEALTH                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service Worker Caching     âœ“âœ“âœ“ (GOOD)                      â”‚
â”‚ IndexedDB Storage          âœ“âœ“âœ“ (GOOD)                      â”‚
â”‚ Manager Pattern            âœ“âœ“âœ“ (GOOD)                      â”‚
â”‚ Type Safety                âœ“âœ“âœ“ (GOOD)                      â”‚
â”‚ Error Logging              âœ“âœ“  (FAIR)                      â”‚
â”‚ Error Recovery             âš ï¸  (NEEDS WORK)                â”‚
â”‚ Data Validation            âŒ  (MISSING)                   â”‚
â”‚ Conflict Handling          âŒ  (MISSING)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PERFORMANCE METRICS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Typical Sync Time (10 LVs)    ~30-60 seconds              â”‚
â”‚ Storage per LV                ~2-5MB                       â”‚
â”‚ Storage per Termo             ~500KB                       â”‚
â”‚ Storage per Photo             ~500KB (ideal: 200KB)        â”‚
â”‚ Max Recommended Records       ~500 before slowdown         â”‚
â”‚ Mobile Device Quota Risk      HIGH (photos cause issues)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CRITICAL IMPROVEMENTS NEEDED              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ P0: Transaction support (prevent orphaned data)         â”‚
â”‚ ğŸ”´ P0: Conflict detection (prevent silent overwrites)      â”‚
â”‚ ğŸ”´ P0: Sync blocking (prevent logout with pending data)    â”‚
â”‚                                                             â”‚
â”‚ ğŸŸ  P1: Photo compression (reduce storage usage 50%)        â”‚
â”‚ ğŸŸ  P1: Persistent sync queue (not manual)                  â”‚
â”‚ ğŸŸ  P1: Data validation (before save/sync)                  â”‚
â”‚                                                             â”‚
â”‚ ğŸŸ¡ P2: Storage quota monitoring (warn at 80%)              â”‚
â”‚ ğŸŸ¡ P2: Soft deletes (recovery capability)                  â”‚
â”‚ ğŸŸ¡ P2: Sync retry logic (exponential backoff)              â”‚
â”‚                                                             â”‚
â”‚ ğŸ”µ P3: UI progress indicators (sync status)                â”‚
â”‚ ğŸ”µ P3: Offline analytics (debug sync issues)               â”‚
â”‚ ğŸ”µ P3: Background sync API (automatic retry)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

**Generated:** November 8, 2025  
**For:** EcoField Development Team  
**Scope:** Offline System Architecture & Data Flow Analysis
